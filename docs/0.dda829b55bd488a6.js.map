{"version":3,"file":"0.dda829b55bd488a6.js","mappings":"2PAUO,MAAMA,EAAsBA,KAEjC,MAAMC,EAAY,IAAIC,OACpBC,EAAAC,GAAA,IAAIC,IAAIF,EAAAG,EAAAH,EAAAI,EAAA,KAAAJ,EAAAK,KAWV,OANE,KAHIC,EAAcC,MAAkBT,GAGpC,CAEE,iBACAU,MAAOC,GAAkBC,QAAQC,IAAI,mBAAoBF,KAGrBG,KAAMC,KAC5Cf,YACAe,gBACA,EAGSC,EAA0B,eAAAC,KAAAC,KAAG,UACxCC,SAGMA,EAAKJ,YAAYK,QAEvBD,EAAKnB,UAAUqB,WACjB,GAAC,gBAPsCC,GAAA,OAAAL,EAAAM,MAAAC,KAAAC,UAAA,KAS1BC,EAA0BA,OACpCC,OAAOC,MAAgBC,SAASV,KAAKW,OACnCf,8FClCE,MAAMgB,EAAkB,CAC7B,CACEC,KAAM,GACNC,cAAeA,IACbC,QAAAC,IAAA,CAAAjC,EAAAkC,EAAA,KAAAlC,EAAAkC,EAAA,KAAAlC,EAAAkC,EAAA,KAAAlC,EAAAkC,EAAA,MAAAtB,KAAAZ,EAAAmC,KAAAnC,EAAA,OACFoC,QAAS,CACPR,OAAQ/B,MAEVwC,cAAe,gBAAAtB,KAAAC,KACb,UACEsB,EACAC,GAEA,eAAMzB,MAA2ByB,EAAatB,KAAKW,SAC5C,CACT,GAAC,gBAAAR,EAAAoB,GAAA,OAAAzB,EAAAM,MAAAC,KAAAC,UAAA,EAPY,MAYnBkB,EAAeZ","names":["excelWorkerProvider","rawWorker","Worker","__webpack_require__","tu","URL","p","u","b","workerProxy","wrap","proxy","param","console","log","then","proxyWorker","destroyExcelWorkerProvider","_ref","_asyncToGenerator","data","releaseProxy","terminate","_x","apply","this","arguments","getWorkerFromRouterData","inject","ActivatedRoute","snapshot","worker","ROUTES","path","loadComponent","Promise","all","e","bind","resolve","canDeactivate","component","currentRoute","_x2","__WEBPACK_DEFAULT_EXPORT__"],"sourceRoot":"webpack:///","sources":["./src/app/excel-writer-with-comlink-worker-demo/provider/worker.provider.ts","./src/app/excel-writer-with-comlink-worker-demo/routes.ts"],"sourcesContent":["import { proxy, releaseProxy, Remote, RemoteObject, wrap } from 'comlink';\nimport { inject } from '@angular/core';\nimport { ActivatedRoute } from '@angular/router';\nimport { type ExcelWorker } from '../worker/excel.worker';\n\nexport interface ExcelWorkerResolveData {\n  rawWorker: Worker;\n  proxyWorker: Remote<ExcelWorker>;\n}\n\nexport const excelWorkerProvider = (): Promise<ExcelWorkerResolveData> => {\n  // create native worker\n  const rawWorker = new Worker(\n    new URL('./../worker/excel.worker', import.meta.url)\n  );\n  const workerProxy = wrap<ExcelWorker>(rawWorker);\n  const workerProxyCreateInstancePromise =\n    // @ts-ignore\n    new workerProxy(\n      // fill constructor params\n      'paramString',\n      proxy((param: string) => console.log('inited paramFn: ', param))\n    ) as Promise<Remote<ExcelWorker>>;\n\n  return workerProxyCreateInstancePromise.then((proxyWorker) => ({\n    rawWorker,\n    proxyWorker,\n  }));\n};\n\nexport const destroyExcelWorkerProvider = async (\n  data: ExcelWorkerResolveData\n) => {\n  // call Comlink \"onDestroy\"\n  await data.proxyWorker[releaseProxy]();\n  // destroy worker\n  data.rawWorker.terminate();\n};\n\nexport const getWorkerFromRouterData = () =>\n  (inject(ActivatedRoute).snapshot.data['worker'] as ExcelWorkerResolveData)\n    .proxyWorker;\n","import { ActivatedRouteSnapshot, Route } from '@angular/router';\nimport type NativeWorkerDemoComponent from '../native-worker-demo/native-worker-demo.component';\nimport {\n  destroyExcelWorkerProvider,\n  excelWorkerProvider,\n} from './provider/worker.provider';\n\nexport const ROUTES: Route[] = [\n  {\n    path: '',\n    loadComponent: () =>\n      import('./excel-writer-with-comlink-worker-demo.component'),\n    resolve: {\n      worker: excelWorkerProvider,\n    },\n    canDeactivate: [\n      async (\n        component: NativeWorkerDemoComponent,\n        currentRoute: ActivatedRouteSnapshot\n      ) => {\n        await destroyExcelWorkerProvider(currentRoute.data['worker']);\n        return true;\n      },\n    ],\n  },\n];\n\nexport default ROUTES;\n"],"x_google_ignoreList":[]}