(()=>{"use strict";const H=Symbol("Comlink.proxy"),Z=Symbol("Comlink.endpoint"),ee=Symbol("Comlink.releaseProxy"),w=Symbol("Comlink.finalizer"),S=Symbol("Comlink.thrown"),U=t=>"object"==typeof t&&null!==t||"function"==typeof t,N=new Map([["proxy",{canHandle:t=>U(t)&&t[H],serialize(t){const{port1:e,port2:r}=new MessageChannel;return C(t,e),[r,[r]]},deserialize:t=>(t.start(),function ie(t,e){return M(t,[],e)}(t))}],["throw",{canHandle:t=>U(t)&&S in t,serialize({value:t}){let e;return e=t instanceof Error?{isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:{isError:!1,value:t},[e,[]]},deserialize(t){throw t.isError?Object.assign(new Error(t.value.message),t.value):t.value}}]]);function C(t,e=globalThis,r=["*"]){e.addEventListener("message",function n(s){if(!s||!s.data)return;if(!function ne(t,e){for(const r of t)if(e===r||"*"===r||r instanceof RegExp&&r.test(e))return!0;return!1}(r,s.origin))return void console.warn(`Invalid origin '${s.origin}' for comlink proxy`);const{id:i,type:o,path:c}=Object.assign({path:[]},s.data),u=(s.data.argumentList||[]).map(g);let a;try{const l=c.slice(0,-1).reduce((f,_)=>f[_],t),p=c.reduce((f,_)=>f[_],t);switch(o){case"GET":a=p;break;case"SET":l[c.slice(-1)[0]]=g(s.data.value),a=!0;break;case"APPLY":a=p.apply(l,u);break;case"CONSTRUCT":a=function le(t){return Object.assign(t,{[H]:!0})}(new p(...u));break;case"ENDPOINT":{const{port1:f,port2:_}=new MessageChannel;C(t,_),a=function ue(t,e){return Y.set(t,e),t}(f,[f])}break;case"RELEASE":a=void 0;break;default:return}}catch(l){a={value:l,[S]:0}}Promise.resolve(a).catch(l=>({value:l,[S]:0})).then(l=>{const[p,f]=T(l);e.postMessage(Object.assign(Object.assign({},p),{id:i}),f),"RELEASE"===o&&(e.removeEventListener("message",n),V(e),w in t&&"function"==typeof t[w]&&t[w]())}).catch(l=>{const[p,f]=T({value:new TypeError("Unserializable return value"),[S]:0});e.postMessage(Object.assign(Object.assign({},p),{id:i}),f)})}),e.start&&e.start()}function V(t){(function se(t){return"MessagePort"===t.constructor.name})(t)&&t.close()}function P(t){if(t)throw new Error("Proxy has been released and is not useable")}function j(t){return y(t,{type:"RELEASE"}).then(()=>{V(t)})}const x=new WeakMap,A="FinalizationRegistry"in globalThis&&new FinalizationRegistry(t=>{const e=(x.get(t)||0)-1;x.set(t,e),0===e&&j(t)});function M(t,e=[],r=function(){}){let n=!1;const s=new Proxy(r,{get(i,o){if(P(n),o===ee)return()=>{(function ce(t){A&&A.unregister(t)})(s),j(t),n=!0};if("then"===o){if(0===e.length)return{then:()=>s};const c=y(t,{type:"GET",path:e.map(u=>u.toString())}).then(g);return c.then.bind(c)}return M(t,[...e,o])},set(i,o,c){P(n);const[u,a]=T(c);return y(t,{type:"SET",path:[...e,o].map(l=>l.toString()),value:u},a).then(g)},apply(i,o,c){P(n);const u=e[e.length-1];if(u===Z)return y(t,{type:"ENDPOINT"}).then(g);if("bind"===u)return M(t,e.slice(0,-1));const[a,l]=W(c);return y(t,{type:"APPLY",path:e.map(p=>p.toString()),argumentList:a},l).then(g)},construct(i,o){P(n);const[c,u]=W(o);return y(t,{type:"CONSTRUCT",path:e.map(a=>a.toString()),argumentList:c},u).then(g)}});return function oe(t,e){const r=(x.get(e)||0)+1;x.set(e,r),A&&A.register(t,e,t)}(s,t),s}function ae(t){return Array.prototype.concat.apply([],t)}function W(t){const e=t.map(T);return[e.map(r=>r[0]),ae(e.map(r=>r[1]))]}const Y=new WeakMap;function T(t){for(const[e,r]of N)if(r.canHandle(t)){const[n,s]=r.serialize(t);return[{type:"HANDLER",name:e,value:n},s]}return[{type:"RAW",value:t},Y.get(t)||[]]}function g(t){switch(t.type){case"HANDLER":return N.get(t.name).deserialize(t.value);case"RAW":return t.value}}function y(t,e,r){return new Promise(n=>{const s=function fe(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}();t.addEventListener("message",function i(o){!o.data||!o.data.id||o.data.id!==s||(t.removeEventListener("message",i),n(o.data))}),t.start&&t.start(),t.postMessage(Object.assign({id:s},e),r)})}function h(t){return"function"==typeof t}const R=function he(t){const r=t(n=>{Error.call(n),n.stack=(new Error).stack});return r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,r}(t=>function(r){t(this),this.message=r?`${r.length} errors occurred during unsubscription:\n${r.map((n,s)=>`${s+1}) ${n.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=r});function L(t,e){if(t){const r=t.indexOf(e);0<=r&&t.splice(r,1)}}class d{constructor(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let e;if(!this.closed){this.closed=!0;const{_parentage:r}=this;if(r)if(this._parentage=null,Array.isArray(r))for(const i of r)i.remove(this);else r.remove(this);const{initialTeardown:n}=this;if(h(n))try{n()}catch(i){e=i instanceof R?i.errors:[i]}const{_finalizers:s}=this;if(s){this._finalizers=null;for(const i of s)try{q(i)}catch(o){e=e??[],o instanceof R?e=[...e,...o.errors]:e.push(o)}}if(e)throw new R(e)}}add(e){var r;if(e&&e!==this)if(this.closed)q(e);else{if(e instanceof d){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!==(r=this._finalizers)&&void 0!==r?r:[]).push(e)}}_hasParent(e){const{_parentage:r}=this;return r===e||Array.isArray(r)&&r.includes(e)}_addParent(e){const{_parentage:r}=this;this._parentage=Array.isArray(r)?(r.push(e),r):r?[r,e]:e}_removeParent(e){const{_parentage:r}=this;r===e?this._parentage=null:Array.isArray(r)&&L(r,e)}remove(e){const{_finalizers:r}=this;r&&L(r,e),e instanceof d&&e._removeParent(this)}}function $(t){return t instanceof d||t&&"closed"in t&&h(t.remove)&&h(t.add)&&h(t.unsubscribe)}function q(t){h(t)?t():t.unsubscribe()}d.EMPTY=(()=>{const t=new d;return t.closed=!0,t})();const b={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},v={setTimeout(t,e,...r){const{delegate:n}=v;return n?.setTimeout?n.setTimeout(t,e,...r):setTimeout(t,e,...r)},clearTimeout(t){const{delegate:e}=v;return(e?.clearTimeout||clearTimeout)(t)},delegate:void 0};function G(){}const pe=F("C",void 0,void 0);function F(t,e,r){return{kind:t,value:e,error:r}}let m=null;class B extends d{constructor(e){super(),this.isStopped=!1,e?(this.destination=e,$(e)&&e.add(this)):this.destination=Se}static create(e,r,n){return new O(e,r,n)}next(e){this.isStopped?D(function be(t){return F("N",t,void 0)}(e),this):this._next(e)}error(e){this.isStopped?D(function ge(t){return F("E",void 0,t)}(e),this):(this.isStopped=!0,this._error(e))}complete(){this.isStopped?D(pe,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(e){this.destination.next(e)}_error(e){try{this.destination.error(e)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const Ee=Function.prototype.bind;function z(t,e){return Ee.call(t,e)}class _e{constructor(e){this.partialObserver=e}next(e){const{partialObserver:r}=this;if(r.next)try{r.next(e)}catch(n){k(n)}}error(e){const{partialObserver:r}=this;if(r.error)try{r.error(e)}catch(n){k(n)}else k(e)}complete(){const{partialObserver:e}=this;if(e.complete)try{e.complete()}catch(r){k(r)}}}class O extends B{constructor(e,r,n){let s;if(super(),h(e)||!e)s={next:e??void 0,error:r??void 0,complete:n??void 0};else{let i;this&&b.useDeprecatedNextContext?(i=Object.create(e),i.unsubscribe=()=>this.unsubscribe(),s={next:e.next&&z(e.next,i),error:e.error&&z(e.error,i),complete:e.complete&&z(e.complete,i)}):s=e}this.destination=new _e(s)}}function k(t){b.useDeprecatedSynchronousErrorHandling?function ye(t){b.useDeprecatedSynchronousErrorHandling&&m&&(m.errorThrown=!0,m.error=t)}(t):function de(t){v.setTimeout(()=>{const{onUnhandledError:e}=b;if(!e)throw t;e(t)})}(t)}function D(t,e){const{onStoppedNotification:r}=b;r&&v.setTimeout(()=>r(t,e))}const Se={closed:!0,next:G,error:function we(t){throw t},complete:G},Pe="function"==typeof Symbol&&Symbol.observable||"@@observable";function xe(t){return t}let Ae=(()=>{class t{constructor(r){r&&(this._subscribe=r)}lift(r){const n=new t;return n.source=this,n.operator=r,n}subscribe(r,n,s){const i=function ve(t){return t&&t instanceof B||function Te(t){return t&&h(t.next)&&h(t.error)&&h(t.complete)}(t)&&$(t)}(r)?r:new O(r,n,s);return function me(t){if(b.useDeprecatedSynchronousErrorHandling){const e=!m;if(e&&(m={errorThrown:!1,error:null}),t(),e){const{errorThrown:r,error:n}=m;if(m=null,r)throw n}}else t()}(()=>{const{operator:o,source:c}=this;i.add(o?o.call(i,c):c?this._subscribe(i):this._trySubscribe(i))}),i}_trySubscribe(r){try{return this._subscribe(r)}catch(n){r.error(n)}}forEach(r,n){return new(n=X(n))((s,i)=>{const o=new O({next:c=>{try{r(c)}catch(u){i(u),o.unsubscribe()}},error:i,complete:s});this.subscribe(o)})}_subscribe(r){var n;return null===(n=this.source)||void 0===n?void 0:n.subscribe(r)}[Pe](){return this}pipe(...r){return function K(t){return 0===t.length?xe:1===t.length?t[0]:function(r){return t.reduce((n,s)=>s(n),r)}}(r)(this)}toPromise(r){return new(r=X(r))((n,s)=>{let i;this.subscribe(o=>i=o,o=>s(o),()=>n(i))})}}return t.create=e=>new t(e),t})();function X(t){var e;return null!==(e=t??b.Promise)&&void 0!==e?e:Promise}class ke extends d{constructor(e,r){super()}schedule(e,r=0){return this}}const I={setInterval(t,e,...r){const{delegate:n}=I;return n?.setInterval?n.setInterval(t,e,...r):setInterval(t,e,...r)},clearInterval(t){const{delegate:e}=I;return(e?.clearInterval||clearInterval)(t)},delegate:void 0},J={now:()=>(J.delegate||Date).now(),delegate:void 0};class E{constructor(e,r=E.now){this.schedulerActionCtor=e,this.now=r}schedule(e,r=0,n){return new this.schedulerActionCtor(this,e).schedule(n,r)}}E.now=J.now;const Me=new class Ce extends E{constructor(e,r=E.now){super(e,r),this.actions=[],this._active=!1}flush(e){const{actions:r}=this;if(this._active)return void r.push(e);let n;this._active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=r.shift());if(this._active=!1,n){for(;e=r.shift();)e.unsubscribe();throw n}}}(class Ie extends ke{constructor(e,r){super(e,r),this.scheduler=e,this.work=r,this.pending=!1}schedule(e,r=0){var n;if(this.closed)return this;this.state=e;const s=this.id,i=this.scheduler;return null!=s&&(this.id=this.recycleAsyncId(i,s,r)),this.pending=!0,this.delay=r,this.id=null!==(n=this.id)&&void 0!==n?n:this.requestAsyncId(i,this.id,r),this}requestAsyncId(e,r,n=0){return I.setInterval(e.flush.bind(e,this),n)}recycleAsyncId(e,r,n=0){if(null!=n&&this.delay===n&&!1===this.pending)return r;null!=r&&I.clearInterval(r)}execute(e,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const n=this._execute(e,r);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(e,r){let s,n=!1;try{this.work(e)}catch(i){n=!0,s=i||new Error("Scheduled action threw falsy error")}if(n)return this.unsubscribe(),s}unsubscribe(){if(!this.closed){const{id:e,scheduler:r}=this,{actions:n}=r;this.work=this.state=this.scheduler=null,this.pending=!1,L(n,this),null!=e&&(this.id=this.recycleAsyncId(r,e,null)),this.delay=null,super.unsubscribe()}}});var Q;Q=w,C(class ze{constructor(e,r){this._paramString=e,this._paramFn=r,this[Q]=()=>{}}get paramString(){return this._paramString}set paramString(e){console.log("[ComlinkWorker]","call setParamString: ",e),this._paramString=e}get paramFn(){return this._paramFn}set paramFn(e){this._paramFn=e}callParamFn(){this._paramFn("call")}doSomething(e){return 5*e}withCallback(e){(function Fe(t=0,e,r=Me){let n=-1;return null!=e&&(function Re(t){return t&&h(t.schedule)}(e)?r=e:n=e),new Ae(s=>{let i=function Le(t){return t instanceof Date&&!isNaN(t)}(t)?+t-r.now():t;i<0&&(i=0);let o=0;return r.schedule(function(){s.closed||(s.next(o++),0<=n?this.schedule(void 0,n):s.complete())},i)})})(2e3,2e3).subscribe(e)}paramComplexObject(e){console.log("[WORKER]","paramComplexObject:",e)}})})();
//# sourceMappingURL=700.c6c8ea278cf991a8.js.map